"use strict;"
/*  Copyright: 
 *		This work is the intellectual property of Sheridan College. 
 *		Any further copying and distribution outside of class must be within 
 *		the copyright law. Posting to commercial sites for profit is prohibited.
 *  Summer 2016 - Ellen Bajcar, SYST10199 Web Programming, Sheridan College 
 */
function createBoard(){for(var i=0;i<nor;i++){var newRow=document.getElementById("myBoard").appendChild(document.createElement("tr"));for(var c=0;c<noc;c++){var newData=newRow.appendChild(document.createElement("td"));newData.setAttribute("class","empty");newData.row=i;newData.col=c;if((i*5+c)!=12){newData.addEventListener("click",handleClick,false);}}}}
function populateCard(){var newNum;for(var r=0;r<nor;r++){for(var c=0;c<noc;c++){do{newNum=(c*15)+getNewNumber()+1;}
while(usedNums[newNum]);usedNums[newNum]=true;var currCell=theCard[r*5+c];if((r*5+c)!=12){currCell.innerHTML=newNum;}else{currCell.innerHTML="FREE";currCell.style.fontSize="16px";currCell.className="picked";currCell.style.color="white";currCell.style.backgroundColor="black";}}}}
function createCaller(){var newEl=document.createElement("div");var targetEl=document.getElementsByTagName("footer")[0];var parentDiv=targetEl.parentNode;parentDiv.insertBefore(newEl,targetEl);parentDiv=newEl;newEl=document.createElement("button");parentDiv.appendChild(newEl);newEl.setAttribute("id","next");newEl.innerHTML="Call next number";for(var k=1;k<6;k++){targetEl=newEl;newEl=document.createElement("p");parentDiv.insertBefore(newEl,targetEl);switch(k){case 1:newEl.setAttribute("id","past");newEl.innerHTML="&nbsp;";break;case 2:newEl.innerHTML="Unused Numbers";for(var i=0;i<availNums.length;i++)document.getElementById("past").innerHTML+=availNums[i]+" ";break;case 3:newEl.setAttribute("id","usedlist");newEl.innerHTML="Numbers Called";break;case 4:newEl.setAttribute("id","called");newEl.innerHTML="&nbsp;";break;default:newEl.innerHTML="NEW NUMBER";}}}
function initAll(){createBoard();theCard=document.getElementsByTagName("td");populateCard();createCaller();}
function getNewNumber(){return Math.floor(Math.random()*15);}
function reloadPage(){location.reload();}
var usedNums=new Array(76);var nor=5,noc=5;var gameOver=false;var theCard;var calledNums=[];var availNums=[];for(var j=1;j<76;j++)availNums[j-1]=j;var winSets=[[0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24],[0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24],[0,6,12,18,24],[4,8,12,16,20],[0,4,12,20,24]];function checkWinningCombos(element,index,array){var flag=5;for(var i=0;i<element.length;i++){if(theCard[element[i]].className=="picked")flag-=1;}
if(flag==0){for(var i=0;i<element.length;i++){theCard[element[i]].style.backgroundImage="url(images/red5.png)";theCard[element[i]].style.color="white";}
for(var i=0;i<25;i++){theCard[i].removeEventListener('click',handleClick,false);}
gameOver=true;}}
function handleClick(){if(this.className=="picked"&&!gameOver){this.style.color="black";this.style.backgroundImage="none";this.className="empty";return;}
if(this.className=="empty"&&!gameOver){this.style.backgroundImage="url(images/red2.png)";this.className="picked";winSets.forEach(checkWinningCombos);if(gameOver==true)document.getElementById("next").style.display="none";}
return;}
document.addEventListener("DOMContentLoaded",initAll(),false);document.getElementById("reset").addEventListener("click",reloadPage,false);document.getElementById("next").addEventListener("click",function(){var num=availNums[Math.floor(Math.random()*availNums.length)];if(num in calledNums)console.log("duplicate? "+num+" in "+
calledNums.sort());removeFromArray(availNums,num);document.getElementById("called").innerHTML=num;document.getElementById("usedlist").innerHTML="Numbers already called <br>"+calledNums.valueOf();calledNums.push(num);document.getElementById("past").innerHTML="";for(var i=0;i<availNums.length;i++){document.getElementById("past").innerHTML+=availNums[i]+" ";}
for(var i=0;i<25;i++){if(theCard[i].innerHTML==num){theCard[i].style.backgroundImage="url(images/orange1.png)";theCard[i].className="picked";winSets.forEach(checkWinningCombos);if(gameOver==true)document.getElementById("next").style.display="none";}}
function removeFromArray(array,item){var itemIndex;itemIndex=array.indexOf(item);while(itemIndex!==-1){array.splice(itemIndex,1);itemIndex=array.indexOf(item);}
return array;}},false);