<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Memory Game</title>	
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
body {
	background: url(../games3/images/bg11.jpg) no-repeat; /* #c1d72e; */
	background-size: cover;
	font-family: Helvetica, Arial, "Lucida Grande", sans-serif;
	color: #fff;
	width: 680px;
	margin: 0 auto;
	text-align: center;
}
h1,h3{
	font-size:4em;
	margin:.2em 0;
	color:#00f;
	text-shadow:1px 1px 1px #fff,2px 2px 6px #000
}
table, tr {
	margin: auto;
	text-align: center;
	border-collapse: collapse; 
	padding: 0;

}
td {
	width: 75px;
	height: 72px;
	padding: 0 3px;
	margin: 0;	
	background-color: transparent;	
}
img {
	width: 100%;
	height: 100%;
	border: 1px solid orange;
	box-shadow: 1px 1px 2px white, 2px 2px 5px black;
	background-color: white;
}
input {
	width: 200px;
	height: 1.6em;
	background-color: orange;
	font-size: 1.2em;
	margin: 8px auto;
}
/* overlay and popup messages styling */
#messg {        
    background-color: 	white; 
    border: 			1px solid white; 
    border-radius: 		5px;
    box-shadow: 		1px 1px 5px black, -1px -1px 5px white;
    display: 			none; 
    height: 			30%;
	left: 				50%;
    margin: 			auto; 
    padding: 			20px;
    position: 			fixed;
	text-align: 		center;
	top: 				50%;
	transform: 			translate(-50%, -50%);
    width: 				60%;        
    z-index: 			200;         
}	
#overlay { 
    background-color: 	rgba(20, 20, 20, 0.8); 
    display: 			none;
    height: 			100%;
    left: 				0; 
    position: 			fixed;  
    top: 				0; 
    width: 				100%;
    z-index: 			100;      
}
	</style>
</head>

<body>
	<!-- ADDED hidden overlays -->
	<div id="messg">
        <p>GAME OVER!</p>
        <h3 id="winner"></h3>
        <p>&mdash;click anywhere in the box to dismiss this message&mdash;</p>
    </div>
	<div id="overlay"></div>
	
	
	
	
	<header id="title"><h3>Pick-A-Pair</h3></header>
	<form name="mForm"> 
		<table id="myBoard"></table>
		<input type="button" value="    " name="mButton" onClick="init()">
	</form>
	<footer><address>Ellen @ SYST10199 Web Programming, Sheridan College</address></footer>	
<script>
document.addEventListener("DOMContentLoaded", init, false);
	var pics = new Array();
	for (var i = 0; i <= 18; i++) {
		pics[i] = new Image();
		pics[i].src = 'image' + i + '.png';
	}
	var map=new Array(1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 
		10, 10, 11, 11, 12, 12, 13, 13, 14, 14, 15, 15, 16, 16, 17, 17, 18, 18);
	var user = [];
	var temparray = new Array();
	var clickarray = new Array(0, 0);
	var ticker, sec, min, ctr, id, okToClick, finished;

function init() {
	for (r = 0; r <= 5; r++) {
		var newRow = document.getElementById("myBoard").appendChild(document.createElement("tr"));
		for (c = 0; c <= 5; c++) {
			var newCell = newRow.appendChild(document.createElement("td"));
			var newLink = newCell.appendChild(document.createElement("a"));
			var newImg = newLink.appendChild(document.createElement("img"));
			newImg.setAttribute("src","image0.gif");
			newImg.setAttribute("name","img"+((6*r)+c));
			newLink.setAttribute("href","javascript:showimage("+((6*r)+c)+")");
			console.log(((6*r)+c));
			newLink.onClick = document.mForm.mButton.focus();
		}
	}

	// start timer...
	clearTimeout(id);
	for ( var i=0; i<36; i++ ) user[i] = 0;  // TODO:  ???
	ticker = 0;
	min = 0;
	sec = 0;
	ctr = 0;
	okToClick = true;
	finished = 0;
	document.mForm.mButton.value = ""; // TIMER: cleared
	scramble();
	runclk();
	for (i = 0; i <= 35; i++) {
		document.mForm[('img'+i)].src = "image0.gif";
	   }
}
	function runclk() {
		min = Math.floor(ticker/60);
		sec = (ticker-(min*60))+'';
		if(sec.length == 1) {sec = "0"+sec};
		ticker++;
		document.mForm.mButton.value = min+":"+sec; // TIMER: update display
		id = setTimeout('runclk()', 1000);
	}
	
	function scramble() {
		for (var z = 0; z < 5; z++) {
			for (var x = 0; x <= 35; x++) {
				temparray[0] = Math.floor(Math.random()*36);
				temparray[1] = map[temparray[0]];
				temparray[2] = map[x];
				map[x] = temparray[1];
				map[temparray[0]] = temparray[2];
		  }
	   }
	}
	
	function showimage(but) {
		if (okToClick) {
			okToClick = false; 
			console.log("map "+but+' image'+map[but]+'.png');
			document.mForm[('img'+but)].src = 'image'+map[but]+'.png';//TODO:???
			
			if (ctr == 0) {
				ctr++;
				clickarray[0] = but;
				okToClick = true;
			} else {
				clickarray[1] = but;
				ctr = 0;
				setTimeout('returntoold()', 500);
			}
		}
	}
	
	function returntoold() {
		if ((clickarray[0] == clickarray[1]) && (!user[clickarray[0]])) {
			document.mForm[('img'+clickarray[0])].src = "image0.gif";
			okToClick = true;
		} else {
			if (map[clickarray[0]] != map[clickarray[1]]) {
				if (user[clickarray[0]] == 0) {
					document.mForm[('img'+clickarray[0])].src = "image0.gif";
				}
				if (user[clickarray[1]] == 0) {
					document.mForm[('img'+clickarray[1])].src = "image0.gif";
				   }
			}
			if (map[clickarray[0]] == map[clickarray[1]]) {
				if (user[clickarray[0]] == 0&&user[clickarray[1]] == 0) {
					finished++; 
				}
				user[clickarray[0]] = 1;
				user[clickarray[1]] = 1;
			}
			if (finished >= 18) {
				//alert('You did it in '+document.mForm.mButton.value+' !');
				document.getElementById("winner").innerHTML = 'You did it in '+
						document.mForm.mButton.value+' !';
				// ADDED display layover
				popup.style.display = "block";
				olay.style.display = "block"; 
				msg.style.display = "none"; 
				// TODO: remove current board
				init();
			} else {
				okToClick = true;
			}
		}
	}  // end funcion returntoold()

	
    var popup = document.getElementById("messg");	
    var olay = document.getElementById("overlay");
    var winner = document.getElementById("winner");
    // dismiss overlay message when user clicks anywhere on the message 
    popup.addEventListener("click", function() {
        popup.style.display = "none";
        olay.style.display = "none";
    }, false );
    msg.style.display = "none"; // unhide in gameReset	
</script>

</body>
</html>