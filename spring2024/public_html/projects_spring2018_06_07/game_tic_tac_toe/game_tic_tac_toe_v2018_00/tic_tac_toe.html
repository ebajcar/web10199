<!DOCTYPE html>
<html lang="en">
<head>
    <title>Tic Tac Toe 2018</title>
    <meta charset="utf-8">
<!-- 
Author: Ellen Bajcar
Program: index_s2018.html
Date: Summer 2018
Date Updated: 
Version: 1.0 
Purpose: learning Javascript programming
Copyright: 
    This work is the intellectual property of Sheridan College. 
    Any further copying and distribution outside of class must be within 
    the copyright law. Posting to commercial sites for profit is prohibited.
Description:
    A two-player game. 
    The players are presented with a board of three-by-three table and a reset button.
    The reset button starts a game where players take turns selecting one of the nine
    available empty cells with the goal of completing a row, a column, or a diagonal to
    win the game.
    A message specifying which player's turn is presented during the same.
    When a winning state occurs, a message is presented that the game is over.
-->	
<style>
body {
	background: #e0e0e0;
    font-family: Helvetica,Arial,"Lucida Grande",sans-serif;
    margin: 0 auto;
    text-align: center;
}
main, section {
	width: 100%;
	margin: auto;
	padding-top: 20px;
	background-color: white;	
}
main {
	padding-top: 20px;
	padding-bottom: 10px;
	min-height: 300px;
	display: flex;
	justify-content: center;	
}
header h1 {
	color: #6f6f6f;   
    font-family: Lato, sans-serif;
    font-size: 40px;
    font-weight: 400;
	margin: 20px 0 0;
    text-align: center;
    text-shadow: 0 0 0 rgba(0,0,0,.4);
}
h2 {
	padding: 2px 0 3px;
	margin: 0;
}
footer {
	margin: auto;
	padding-top: 10px;
	margin-top: 10px;
	text-align: center;
	color: gray;
}
button {
  padding: 1rem;
  border: 1px solid #ccc;
  background-color: #ddd;
  -webkit-transition: background-color 200ms ease;
  transition: background-color 200ms ease;
}
button:hover {
  cursor: pointer;
  background-color: #eee;
}

/* navigation */
nav {
    margin: 20px auto;
    width: 450px;
	text-align: center;
}
nav a {
    background-color: #a4a4a4;
	color: #fff;
    display: inline-block;
	font-family: Lato, sans-serif;
    font-size: 15px;
    padding: 7px;
    text-decoration: none;
}
nav a.active, nav a:hover {
    background: #c2c2c2;
    color: #818181;
}

/* game board */
table {
    margin: 0 auto;
	background-color: transparent;
}
td {
    height: 50px;
    width: 50px;
    font-size: 2.2em;
    font-family: sans-serif;
    border: 1px solid #00f;
	background-color: transparent;
}
td:nth-child(1) {
    border-left-style: none;
}
td:nth-child(3) {
    border-right-style: none;
}
tr:nth-child(1)>td {
    border-top-style: none;
}
tr:nth-child(3)>td {
    border-bottom-style: none;
}

/* overlay and popup messages styling */
.dialog {
  width: 80vw;
  border: 0;
  background-color: white;
  -webkit-box-shadow: 0px 0px 20px 0px rgba(0, 0, 0, 0.2);
          box-shadow: 0px 0px 20px 0px rgba(0, 0, 0, 0.2);
}
@media (min-width: 400px) {
  .dialog {
    width: 50vw;
    border: 0;
    -webkit-box-shadow: 0px 0px 20px 0px rgba(0, 0, 0, 0.2);
            box-shadow: 0px 0px 20px 0px rgba(0, 0, 0, 0.2);
  }
}
.dialog h2 {
    font-size: 3em;
    margin: .2em 0;
    color: orange;
    text-shadow: 1px 1px 1px #fff,2px 2px 6px #000;
}
.dialog p:first-child {
	letter-spacing: 3px;
}
</style>
</head>
<body>
    <header><h1>Tic Tac Toe</h1></header>
	<nav>
		<a href="">Home</a>
		<a href="">Casino Craps</a>
		<a class="active" href="">Tic Tac Toe</a>
		<a href="">Bingo</a>
		<a href="">Concentration</a>
	</nav>		
	<main>
		<!-- game board and related content -->
		<div id="game"></div>
		
		<!-- dialog popup when the game is over -->
		<dialog  id="messg" class="dialog">
			<p>GAME OVER!</p>
			<h2 id="winner"></h2>
			<p>&mdash; click anywhere to dismiss this message &mdash;</p>
		</dialog>		 
	</main>
	<footer><address>SYST10199 Web Programming @ Sheridan College</address></footer>
<script>
/*
	Author: Ellen Bajcar
	Program: ticTacToe.js 
	Date: Summer 2016 
	Date Updated: 8:25 AM June-09-16
	Version: 5.0 (Week 5 stage)
	Purpose: learning Javascript programming
	Copyright: This work is the intellectual property of Sheridan College. 
		Any further copying and distribution outside of class must be within 
		the copyright law. Posting to commercial sites for profit is prohibited.
	Description:
		A two-player game. 
		The players are presented with a board of three-by-three table and a reset button.
		The reset button starts a game where players take turns selecting one of the nine
		available empty cells with the goal of completing a row, a column, or a diagonal to
		win the game.
		A message specifying which player's turn is presented during the same.
		When a winning state occurs, a message is presented that the game is over.
	TODO: need a function to "unload" the game's DOM nodes
*/

// delay loading javascript until page is loaded
document.addEventListener("DOMContentLoaded", playTicTac());

// ADDED: game functionality placed in function playTicTac
function playTicTac() {
    /*
		Tic Tac Toe Game functionality
		self-contained, the function can be called any time anywhere
		will create the playing environment, including the board...
	*/
    function createBoard() {
		// MOVED declarations inside the function - used only here
		var myTable, myRow, myCell, myData, myBoard, myTitle;
		var gameTitle = ["T", "I", "C", "T", "A", "C", "T", "O", "E"];
		myBoard = document.getElementById("game");
		var par = document.createElement("p");
		var elSpanMsg = document.createElement("span");
		elSpanMsg.setAttribute("id", "msg");
		elSpanMsg.style.fontFamily = "monospace";
		elSpanMsg.appendChild(document.createTextNode("Player "));
		var elSpan = document.createElement("span");
		elSpan.setAttribute("id", "player");
		elSpanMsg.appendChild(elSpan);
		elSpanMsg.appendChild(document.createTextNode(""));
		elSpanMsg.appendChild(document.createTextNode(" go! "));
		par.appendChild(elSpanMsg);
		var elButton = document.createElement("button");
		// TODO: need to change to "Reset Game" at some point
		elButton.appendChild(document.createTextNode(
			"Click to start a game"));
		elButton.setAttribute("id", "reset");
		par.appendChild(elButton);
		myBoard.appendChild(par);		

		myTable = document.createElement("table");		
		for (var i = 0; i < 3; i++) {
			myRow = document.createElement("tr");
			myTable.appendChild(myRow);
			for (var j = 0; j < 3; j++) {
				myCell = document.createElement("td");
				myRow.appendChild(myCell);
				myData = document.createTextNode(gameTitle[j + (i * 3)]);
				myCell.appendChild(myData);
			}
		}
		myBoard.appendChild(myTable);
	}

	/* 
	function checkWin() is called to check all winning combinations
	*/
    function checkWin() {
        // check all eight winning sets, if one found, display game over 
        for (var i = 0; i < winSets.length; i++) {
            if (board[winSets[i][0]].innerHTML == board[winSets[i][1]].innerHTML &&
                board[winSets[i][1]].innerHTML == board[winSets[i][2]].innerHTML &&
                board[winSets[i][0]].innerHTML != "") {
                // MOVED **		
                // highlight the winning combo on screen
                for (var j = 0; j < 3; j++) {
                    board[winSets[i][j]].style.color = "red";
                }
                // MOVED from ** 
                displayWin(); // display  game over, current player wins
            }
        }
        // check if there are any remaining empty cells, if no empty cells, display game over
        // !gameover needs to be checked in case the winning combo occurs at the same time
        if (empty == 0 && !gameover) {
            player = "No one ";
            displayWin();
        }
    }

    function displayWin() {
            gameover = true;
            document.getElementById("winner").innerHTML = player +
                "  wins!";
            // ADDED display layover
			messg.showModal();
            //messg.style.display = "block";
            //olay.style.display = "block";
            msg.style.display = "none";
        }

	/*
		Function cellClick() is called 
			when the event listeners for the "td" cells fire which occurs
			when the user clicks on one of the nine cells of the board
		1. sets the content of the clicked cell to the current player's mark
		2. checks whether or not there is a winner
		3. flips (changes) the current player
		4. updates the message tot he current player
		TODO: 1-4 should occur only when the selected cell is empty !!	
	*/
    function cellClick(cell) {
            // added conditional on game not being over and cells available
            if (!gameover && cell.innerHTML == "") {
                cell.innerHTML = player; // place the user character
                empty--; // one less cells is available
                checkWin(); // check if there is a winning combination
                (player == "X") ? player = "O": player = "X";
                document.getElementById("player").innerHTML = player;
                // change the background of the last cell played to indicate what was the last move 
                // ADDED highlight current move, reset previous move
                prev.style.backgroundColor = "white";
                prev = cell;
                cell.style.backgroundColor = "lightblue";
            }
        }
 
	/*
		function gameReset() is called when user clicks on the "game reset" button
		1. sets content of all 9 cells to nothing
		2. sets the starting player (this version, X always starts the game)
		3. updates the message to the current player
		4. resets the number of empty cells to 9
		5. sets the game over flag to false to indicate that the game is in progress
	*/
    function gameReset() {
            for (var i = 0; i < board.length; i++) {
                board[i].innerHTML = "";
                board[i].style.backgroundColor = "white"; // ADDED reset all backgrounds (prev)
            }
            player = "X";
            document.getElementById("player").innerHTML = "X";
            empty = 9;
            gameover = false;
            // added resetting font color
            for (var j = 0; j < board.length; j++) {
                board[j].style.color = "black";
            }
            btn.innerHTML = "Reset Game";
            msg.style.display = "inline";
        }
		
		
    // set up all variable and data structures
    var player = "X"; // current player
    var board = document.getElementsByTagName("td"); //array (collection) of 9 objects
    var winSets = [
        [0, 1, 2],
        [3, 4, 5],
        [6, 7, 8],
        [0, 3, 6],
        [1, 4, 7],
        [2, 5, 8],
        [0, 4, 8],
        [2, 4, 6]
    ]; //all winning combinations, 3 rows, 3 columns, 2 diagonals
    var empty = 9; // number of available (empty) cells
    var gameover = false; // game not in session (false if in process)
    // create the game board
    createBoard();
    /*
		Set up event listeners
		1. when user clicks on the reset button (id="reset")
		2. when user clicks on the the 9 cells of the board
	*/
    //document.getElementById("reset").addEventListener("click", gameReset);
	document.getElementById("reset").addEventListener("click", 
		function() {
				gameReset();
			});
    for (var i = 0; i < board.length; i++) board[i].addEventListener(
        "click", function() {
            cellClick(this);
        });
    /*
		ADDED
		display and style overlays with messages 
	*/
    var prev = board[0]; // to flag the previous move for background highlight
    var btn = document.getElementById("reset");
    var messg = document.getElementById("messg");
    var olay = document.getElementById("overlay");
    var winner = document.getElementById("winner");
	

    // dismiss overlay message when user clicks anywhere on the message 
    messg.addEventListener("click", function() {
		messg.close();
        //messg.style.display = "none";
        //olay.style.display = "none";
    }, false);
    msg.style.display = "none"; // unhide in gameReset
    /*
		Further enhancements
		- make the starting player random (optional)
		- keep track of statistics (how many times X wins ) (optional)
	*/
}
</script> 
</body>
</html>