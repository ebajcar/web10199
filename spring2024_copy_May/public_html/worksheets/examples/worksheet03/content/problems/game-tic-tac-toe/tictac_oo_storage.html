<!DOCTYPE html>
<html>
<head>
<title>Tic Tac Toe</title>
<meta charset="utf-8">
<!-- 
Author: Ellen Bajcar
Program: ticTacToe.html
Date: Summer 2016
Date Updated: 8:25 AM June-09-16
Version: 5.0 (Week 5 stage)
Purpose: learning Javascript programming
Copyright: 
    This work is the intellectual property of Sheridan College. 
    Any further copying and distribution outside of class must be within 
    the copyright law. Posting to commercial sites for profit is prohibited.
Description:
   object-oriented approach for tic tac toe game
-->
<style>
@import  http://fonts.googleapis.com/css?family=Allan:700;
body {
	background-color: transparent;
    background-size: cover;
    font-family: Helvetica,Arial,"Lucida Grande",sans-serif;
    max-width: 480px;
    margin: 0 auto;
    text-align: center;
}
h1,h3 {
    font-size: 4em;
    margin: .2em 0;
    color: #00f;
    text-shadow: 1px 1px 1px #fff,2px 2px 6px #000;
}
table {
    margin: 0 auto;
	background-color: transparent;
}
footer {
    color: lightgray;
    margin-top: 10px;
}
td {
    height: 50px;
    width: 50px;
    font-size: 2.2em;
    font-family: sans-serif;
    border: 1px solid #00f;
	background-color: transparent;
}
button {
    min-width: 200px;
    height: 1.6em;
    background-color: orange;
    font-size: 1.2em;
    margin: 8px auto;
}
td:nth-child(1) {
    border-left-style: none;
}
td:nth-child(3) {
    border-right-style: none;
}
tr:nth-child(1)>td {
    border-top-style: none;
}
tr:nth-child(3)>td {
    border-bottom-style: none;
}
#playerMsg, #message {
	font-family: monospace;
}
.game {
	background-size: 	100% 100%;
    background-color: transparent;
    padding: 25px 0 5px;
    border: 1px solid orange;
    border-radius: 5px;
    box-shadow: 2px 2px 5px gray;
}
/* overlay and popup messages styling */
#messg {        
    background-color: 	white; 
    background-repeat: 	no-repeat;
	background-size: 	100% 100%;
    border: 			1px solid white; 
    border-radius: 		3px;
    box-shadow: 		1px 1px 5px black, -1px -1px 5px white;
    display: 			block; 
    height: 			50%;
	left: 				50%;
    margin: 			auto; 
    padding: 			20px;
    position: 			fixed;
	text-align: 		center;
	top: 				50%;
	transform: 			translate(-50%, -50%);
    width: 				50%;        
    z-index: 			200;         
}	
#messg h2 {
    font-size: 3em;
    margin: .2em 0;
    color: orange;
    text-shadow: 1px 1px 1px #fff,2px 2px 6px #000;
}
#overlay { 
    background-color: 	rgba(20, 20, 20, 0.95); 
    display: 			none;
    height: 			100%;
    left: 				0; 
    position: 			fixed;  
    top: 				0; 
    width: 				100%;
    z-index: 			100;      
}
	</style>
</head>
<body>
    <header>
        <h1>Tic Tac Toe!</h1>
    </header>
	
    <div id="game" class="game"></div> <!-- game board and related content -->
	
    <footer>
        <address>
            SYST10199 Web Programming @ Sheridan College
        </address>
    </footer>
	
	<div id="overlay"> <!-- overlay and popup messages -->
		<div id="messg">
			<p>GAME OVER!</p>
			<h2 id="winner"></h2><p>&mdash; click anywhere in the box to
			dismiss this message &mdash;</p>			
			<form method="GET">
			<p>Total games played: <output id="total">_</output></p>
			<input type="button" value="Reset Statistics" id="clearstats">
			</form>				
		</div>	
    </div>
<script>


var Game = function () {
	this.player = "X";
	this.winSets = [[0, 1, 2],[3, 4, 5],[6, 7, 8],[0, 3, 6],
					[1, 4, 7],[2, 5, 8],[0, 4, 8],[2, 4, 6]];
	this.empty = 9;
	this.gameover = false;
	this.board = document.getElementsByTagName("td");
	this.prev = this.board[0];
}
Game.prototype.checkWinner = function() {
	for (var i = 0; i < this.winSets.length; i++) {
		if (this.board[this.winSets[i][0]].innerHTML == this.board[this.winSets[i][1]].innerHTML &&
			this.board[this.winSets[i][1]].innerHTML == this.board[this.winSets[i][2]].innerHTML &&
			this.board[this.winSets[i][0]].innerHTML != "") {
			for (var j = 0; j < 3; j++) 
				this.board[this.winSets[i][j]].style.color = "red";
			this.displayWinner(); 
		}
	}
	if (this.empty == 0 && !this.gameover) {
		player = "No one";
		this.displayWinner();
	}
};
Game.prototype.displayWinner = function() {	
	this.gameover = true;
	document.getElementById("winner").innerHTML = player +"  wins!";
	document.getElementById("overlay").style.display = "block";
	playerMsg.style.display = "none";	
	
	// MOVED: dismiss overlay on click
	document.getElementById("overlay").addEventListener("click", function() {
		this.style.display = "none";
	}, true);	
	document.getElementById("clearstats").addEventListener("click", function(){					
		clearStorage();	 //localStorage.clear(); 
		}, false);
		
	// ADDED: update local storage	
	if(!localStorage.getItem('ttt_count')) {
	  populateStorage();
	} else {
	  updateStats();
	}
	document.getElementById("total").innerHTML = localStorage.ttt_count;
};
Game.prototype.cellClick = function(curr) {	
	if (!this.gameover && curr.innerHTML == "") {
		curr.innerHTML = player; // place the user character
		this.empty--; // one less cells is available
		this.checkWinner(); // check if there is a winning combination
		(player == "X") ? player = "O": player = "X";
		document.getElementById("playerMsg").innerHTML = "Player " + player + " go! ";
		this.prev.style.backgroundColor = "transparent";
		this.prev = curr;
		curr.style.backgroundColor = "lightblue";
    }  
};
Game.prototype.resetGame = function() {	
	this.prev = this.board[0];
	for (var i = 0; i < this.board.length; i++) {
		this.board[i].innerHTML = "";
		this.board[i].style.backgroundColor = "transparent"; 
	}
	player = "X";
	document.getElementById("playerMsg").innerHTML = "Player " + player + " go! ";
	this.empty = 9;
	this.gameover = false;
	for (var j = 0; j < this.board.length; j++) this.board[j].style.color = "black";
	document.getElementById("reset").innerHTML = "Reset Game";
	playerMsg.style.display = "inline";	  
};
Game.prototype.createBoard = function() {
	var myTable, myRow, myCell, myData, myBoard, myTitle;
	var gameTitle = ["T", "I", "C", "T", "A", "C", "T", "O", "E"];
	myBoard = document.getElementById("game");
	myTable = document.createElement("table");
	myBoard.appendChild(myTable);
	for (var i = 0; i < 3; i++) {
		myRow = document.createElement("tr");
		myTable.appendChild(myRow);
		for (var j = 0; j < 3; j++) {
			myCell = document.createElement("td");
			myRow.appendChild(myCell);
			myData = document.createTextNode(gameTitle[j + (i * 3)]);
			myCell.appendChild(myData);
		}
	}
	var par = myBoard.appendChild(document.createElement("p"));
	var elementSpan = document.createElement("span");
	elementSpan.setAttribute("id", "playerMsg");
	elementSpan.appendChild(document.createTextNode(""));
	par.appendChild(elementSpan);
	var elementButton = document.createElement("button");
	elementButton.appendChild(document.createTextNode("Start New Game"));
	elementButton.setAttribute("id", "reset");
	par.appendChild(elementButton);
	}
Game.prototype.removeBoard = function() {
	var parent = document.getElementById("game");
	while(parent.hasChildNodes()) 
	   parent.removeChild(parent.lastChild);
	delete curGame;
	parent.style.display = "none";
}	

function populateStorage() {	
	localStorage.setItem("ttt_count", 0 );
	localStorage.setItem("ttt_x", 0 );
	localStorage.setItem("ttt_y", 0 );
	localStorage.setItem("ttt_ties", 0 );
	updateStats();
}
function updateStats() {
	localStorage.ttt_count++;
	if ( player == "No one" ) 
			localStorage.ttt_ties++;
	if ( player == "X" )
			localStorage.ttt_x++;
	else
			localStorage.ttt_y++;
}	
function clearStorage() {
	if(localStorage.getItem('ttt_count')) 
		localStorage.removeItem("ttt_count");
	if(localStorage.getItem('ttt_x'))
		localStorage.removeItem("ttt_x");
	if(localStorage.getItem('ttt_y'))
		localStorage.removeItem("ttt_y");
	if(localStorage.getItem('ttt_ties'))
		localStorage.removeItem("ttt_ties");
}	

/*
 *	main set up board, start game, set up event listeners
 */
function playTicTac() {
	// create the game object
	var curGame = new Game();
	// initialize the playing board
	curGame.createBoard();
	// initialize the event listeners
	document.getElementById("reset").addEventListener("click", function() {
			curGame.resetGame();
		});
	for (var i = 0; i < curGame.board.length; i++) 
		curGame.board[i].addEventListener("click", function() {
			curGame.cellClick(this);
		});
}
document.addEventListener("DOMContentLoaded", playTicTac());
// the end
</script> 
</body>
</html>