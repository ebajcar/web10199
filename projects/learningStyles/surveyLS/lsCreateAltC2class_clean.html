<!DOCTYPE html>
<!-- Do not distribute. Ellen Bajcar, 2012-2015 
	 https://dl.dropboxusercontent.com/u/43304210/a2.zip
	 https://piazza.com/sheridancollege.ca/summer2015/syst10199/home
	 https://piazza.com/class/iai3w1pb8g82xb
	 -->
<html>
<head>
	<title>Learning Styles Survey</title>
	<meta charset="utf-8">
	<style>
	body { width: 90%; margin: 10px auto; }
	td { padding: 1px 5px; }
	footer { text-align: right;} 
	.tdreset { background-color: white; color: black;}
	.tdsel {background-color: rgb(72, 209, 204); color: black;}
	.tdgray { background-color: white; color: lightgray;}
	#message { position: fixed; background-color: white; display: none; top: 10%; left: 20%; border: 6px solid gray; width: 60%; margin: 0 auto; z-index: 200; padding: 10px; }	
	#overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(50, 50, 50, 0.9); z-index: 100; display: none; }
	</style>
</head>
<body>
	<button id="submit">submit</button>
	<button id="reset">reset</button>
	<button id="info">info</button>
	<section id="questions"></section>
	<div id="message"></div>
	<div id="overlay"></div>
	<footer><h2>...live and learn!</h2></footer>
<script src="data.js"></script> <!-- provided; contains data structures with content -->
<script type="text/javascript">
	/*  ----------------------------------------------------
		create DOM nodes and populate with data from whenYou 
	    ---------------------------------------------------- */	
	// create title and table for the survey in the section id="questions"
	var newHeading = document.createElement("h1");
	var newTable = document.createElement("table");
	newTable.style.border = "3px navy solid";

	//create child nodes manually
	//and add them as child nodes to the new elements
	var h1Text = document.createTextNode("Take the survey ...");
	newHeading.appendChild(h1Text);

	//and we still need to attach them to the document!
	document.getElementById("questions").appendChild(newHeading);
	document.getElementById("questions").appendChild(newTable);

	//create and populate the table
	var mtable = document.getElementsByTagName("table")[0];
	var currow,curcell;
	for (var j = 0; j < whenYou.length; j++ ) {
		currow = document.createElement("tr");
		mtable.appendChild(currow);
		currow.setAttribute("id", "row"+j);
		for ( var curr in whenYou[j] ) {
			curcell = document.createElement("td");
			currow.appendChild(curcell);
			( whenYou[j][curr] == whenYou[j]["name"]) ? curcell.innerHTML = "When you "+whenYou[j][curr] : curcell.innerHTML = whenYou[j][curr];
			curcell.setAttribute("id", curr+j );
			curcell.setAttribute("name", curr );
			curcell.style.border = "1px navy dotted";
		}
	}

	
	/*	----------------------------------
		process survey and present results
	    ---------------------------------- 	*/ 
	// colname = [ "name", "visual", "auditory", "tactile"];
	var indx = 0;
	var colname = new Array;
	for ( var curr in whenYou[1] ) colname[indx++] = curr;
	

	function submitForm() {
		var theCount = [0,0,0,0 ];
		var col1 = document.getElementsByName(colname[1]);
		var col2 = document.getElementsByName(colname[2]);
		var col3 = document.getElementsByName(colname[3]);
		for (var i = 0; i < col1.length; i++) {
			if (col1[i].selected) theCount[1]++; 
			if (col2[i].selected) theCount[2]++;
			if (col3[i].selected) theCount[3]++;
		}

		//identify primary and auxiliary styles
		var first = Math.max.apply(null, theCount);  // find the highest value
		var prim = colname[theCount.indexOf(first)]; // find equivalent name in parallel array
		theCount[theCount.indexOf(first)] = 0;  // set highest to 0 to find the next highest
		var second = Math.max.apply(null, theCount);  // find new highest value
		var auxy = colname[theCount.indexOf(second)]; // find equivalent name in parallel array		
		
		//display results
		displayResults(prim, auxy, first, second);
		
	} // end submitForm

		
		function displayResults(prim, auxy, first, second) {
			// display primary style
			var alearn = popup.appendChild(document.createElement("h1"));
			alearn.innerHTML = "Your primary style is:  " + prim +" ("+first+")";
			alearn.style.color = "orangered";
			
			//display secondary style
			var blearn = popup.appendChild(document.createElement("h2"));
			blearn.innerHTML = "Your secondary style is:  " + auxy +" ("+second+")";
			blearn.style.color = "orange";		
			
			//display suggested activities for that style
			popup.innerHTML += "<br>What helps " + prim + " learners like me...";
			ulist = document.createElement("ul");
			popup.appendChild(ulist);
			switch (prim) {
				case "visual":
					for (var i=0; i<visualLearner.length; i++) 
						ulist.appendChild(document.createElement("li")).innerHTML = visualLearner[i];
					break;
				case "auditory":
					for (var i=0; i<auditoryLearner.length; i++) 
						ulist.appendChild(document.createElement("li")).innerHTML = auditoryLearner[i];		
					break;
				case "tactile":
					for (var i=0; i<tactileLearner.length; i++) 
						ulist.appendChild(document.createElement("li")).innerHTML = tactileLearner[i];
					break;				
				default:
					var output = "Something has gone wrong. Try again."
			}  // end of switch
			cbutton = popup.appendChild(document.createElement("button"));
			cbutton.innerHTML += "To close - click anywhere inside this box";
			popup.style.display = "block";
		} // end of displayResults
		
		
	/*	----------------------------------------------------------------------------------------------------
		set up event listeners to respond to user events - each row, each cell, 3 buttons, and popup section
		---------------------------------------------------------------------------------------------------- */	
	// set up event listeners for each row and for each cell in the table
	// use row to reset (first column) and gray out unselected cells
	// use cells (columns 2,3, and 4) to highlight the selected choice
	for (var j = 0; j < whenYou.length; j++) {
		document.getElementById("row"+j).addEventListener("click", function () { rowClick(this, "tdgray") }, true);
		document.getElementById(colname[0]+j).addEventListener("click", function(){ rowClick(this.parentElement, "tdreset"); }, true);
		for (var i = 1; i < 4; i++) {
			document.getElementById(colname[i]+j).addEventListener("click", function () { choiceClicked(this)}, true);		
		}		
	}
	// reset ALL cells in a clicked row- 1. parameter-passed class 2. unset "selected" property
	function rowClick(cell, xclass) {
		for (var k = 1; k < 4; k++) {
			cell.getElementsByTagName("td")[k].setAttribute("class", xclass );
			cell.getElementsByTagName("td")[k].selected = false;
		}
	}
	// for the clicked cell only, set "selected" property and set class="tdsel"
	function choiceClicked(cell) {
		cell.selected = true;
		cell.setAttribute("class","tdsel");
	}
	
	// when submit button is clicked, call the submitForm() function that
	// processes the survey and displays results
	document.getElementById("submit").addEventListener("click", submitForm, false);
	
	// reset the entire page, see the location node of the DOM
	document.getElementById("reset").addEventListener("click", 
		function() { location.reload(); }, false);
		
	// create a handle to the message element	
	var popup = document.getElementById("message");	
	var olay = document.getElementById("overlay");
	
	// show instruction message when info button is clicked
	document.getElementById("info").addEventListener("click", function() {
		displayIntro();
		popup.style.display = "block";
		olay.style.display = "block";
	}, false );
	
	// dismiss instruction message when user clicks anywhere on the message (not just the close button)
	document.getElementById("message").addEventListener("click", function() {
		popup.innerHTML = "";
		popup.style.display = "none";
		olay.style.display = "none";
	}, false );

		
	/*	----------------------------------------------------------------------------------------------------
		instruction message data and DOM loading of the message
		----------------------------------------------------------------------------------------------------
	*/	
	var instruct = [
       { "type": "h3", "thetext": "Instructions" },
	   { "type": "p", "thetext": "Read the word(s) in the first column and select the description that best expresses how you usually handle each situation." },
	   { "type": "p", "thetext": "Many responses probably fall in one column, with several in another column, and very few in the remaining one. The column that represents your actions best is your primary processing style.  The second highest is your auxiliary style. Though this test is not very technical or complicated, most adults know how they respond to situations." },
	   { "type": "p", "thetext": "By spending time thinking about reactions, you can identify how you prefer to process information. This assessment looks at your modality preferences. When you press the Submit button, your primary and auxiliary processing style will be displayed, together with some suggestions how to take advantage of your strengths." },
	   { "type": "button", "thetext": "Close" }
	   ];
	var message = new Array;
	for (var k = 0; k < instruct.length; k++) {
		message[k] = document.createElement(instruct[k]["type"]);
		message[k].appendChild(document.createTextNode(instruct[k]["thetext"]));
	}
	function displayIntro() {
			for (var i = 0; i < 5; i++) 
			popup.appendChild(message[i]);
	}
</script>
</body>
</html>