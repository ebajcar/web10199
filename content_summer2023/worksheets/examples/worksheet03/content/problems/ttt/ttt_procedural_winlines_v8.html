<!DOCTYPE html>
<html lang="en">
<head>
<title>Tic Tac Toe (procedural)</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width" />
<!--
    Author: Instructor
    Date: Summer 2016
    Version: Week 2 stage
    Purpose: tic tac toe game
	Copyright: This work is the intellectual property of Sheridan College. Any further copying and distribution outside of class must be within the copyright law. Posting to commercial sites for profit is prohibited.
	Description:
		A two-player game. 
		The players are presented with a board of three-by-three table and a reset button.
		The reset button starts a game where players take turns selecting one of the nine
		available turnsLeft cells with the goal of completing a row, a column, or a diagonal to
		win the game.
		A message specifying which player's turn is presented during the same.
		When a winning state occurs, a message is presented that the game is over.	
    ATTENTION: CONTAINS A LOGIC ERROR
    ATTENTION: CONTAINS A LOGIC ERROR
    ATTENTION: CONTAINS A LOGIC ERROR
    ATTENTION: CONTAINS A LOGIC ERROR
    ATTENTION: CONTAINS A LOGIC ERROR
-->	
<style>
body {
    width: 680px;
    margin: 0 auto;
    text-align: center;
} 
p {
    font-family:monospace;
}
table {
     margin: auto;
} 
td {
    width:50px;
    height:50px;
    border: 1px solid blue;
    font-size:40px;
    text-align:center;
    font-family:arial, helvetica, sans-serif;
} 
tr:first-child td {
    border-top: none;
}
tr:nth-child(3) td {
    border-bottom: none;
}
td:first-child {
    border-left: none;
}
td:last-child {
    border-right: none;
}
</style>
</head>
<body>
    <header><h1>Tic Tac Toe</h1></header>
    
    <table>
        <tr>
            <td>T</td>
            <td>I</td>
            <td>C</td>
        </tr>
        <tr>
            <td>T</td>
            <td>A</td>
            <td>C</td>
        </tr>
        <tr>
            <td>T</td>
            <td>O</td>
            <td>E</td>
        </tr>        
    </table>
    <p> 
      <span id="player"></span>  
      <button id="reset">Start A New Game</button>
	  </p>
    <div id="message"></div>
    
	<footer><address>SYST10199 Web Programming &copy; Sheridan College</address></footer>
    
    
<script>
 
  function displayWinner(player, game) {	
    document.getElementById("message").innerHTML = "Game Over! " + player  + " wins.";
    document.getElementById("player").innerText = "";
    return game.gameover = true;
  }

  function doWeHaveAWinner(cell, game) {
      let winLines = [
          [[1, 2], [4, 8], [3, 6]],
          [[0, 2], [4, 7]],
          [[0, 1], [4, 6], [5, 8]],
          [[4, 5], [0, 6]],
          [[3, 5], [0, 8], [2, 6], [1, 7]],
          [[3, 4], [2, 8]],
          [[7, 8], [2, 4], [0, 3]],
          [[6, 8], [1, 4]],
          [[6, 7], [0, 4], [2, 5]]
      ]; 
      let numOfColumns = 3;
      let cellLocation = (cell.parentNode.rowIndex * numOfColumns)+ cell.cellIndex;   
      let curPosition = cellLocation;
      let len = winLines[cellLocation].length;
      for (let i = 0; i < len; i++) {       
          if ( cell.innerText == game.board[winLines[cellLocation][i][0]].innerText &&
               cell.innerText == game.board[winLines[cellLocation][i][1]].innerText  ) {
               // WE HAVE A WINNER highlight the winning combo on screen
               // TODO: replace CSS style property with DOM methods
               for (let j = 0; j < 2; j++) 
                 game.board[winLines[cellLocation][i][j]].style.color = "red";
               cell.style.color = "red";
                return cellLocation; // index of last cell played
          }      
      }
      console.log("turns " + game.turnsLeft);
      if ( game.turnsLeft == 1 && game.gameover != true ) 
        return "No one "; // it is a scratch
      return false; // no winner yet
  }
  
  function doWeHaveAWinnerUsingWinSets(cell, game) {
      let winSets = [[0,1,2],[3,4,5],[6,7,8],
                   [0,3,6],[1,4,7],[2,5,8],
                   [0,4,8],[2,4,6]];
      let len = winSets.length;
      for (let i = 0; i < len; i++) {
        if ( game.board[winSets[i][0]].innerText == game.board[winSets[i][1]].innerText &&
             game.board[winSets[i][1]].innerText == game.board[winSets[i][2]].innerText &&
             game.board[winSets[i][0]].innerText != "" ) {
               // WE HAVE A WINNER highlight the winning combo on screen
               // TODO: replace CSS style property with DOM methods
               for (let j = 0; j < 3; j++) 
                 game.board[winSets[i][j]].style.color = "red";                
               return cell.cellIndex; // index of last cell played
          }      
      }
      console.log("turns " + game.turnsLeft);
      if ( game.turnsLeft == 1 && game.gameover != true ) 
        return "No one "; // it is a scratch
      return false; // no winner yet
  } 

  function checkStatus(cell, game) {
    //let status = doWeHaveAWinnerUsingWinSets(cell, game);
    let status = doWeHaveAWinner(cell, game);
    //console.log(status);
    // TODO: could consider using switch, but the order matters, start with most frequent/likely
    if (status === false) {
      gameContinues(cell, game);
    } else if (status == "No one ") {
        itIsAScratch(status, game);  
      } else {
        status = cell.innerText;
        weHaveAWinner(status, game);
      }
  }

  function itIsAScratch(status, game) {
    //console.log("no one wins, it's a scratch");
    displayWinner(status, game);
  }

  function weHaveAWinner(status, game) {
    //console.log("we have a winner " + status);
    displayWinner(status, game);  
  }

  function gameContinues(cell, game) {
    //console.log("game continues");
    (game.player == "X" ) ? game.player = "O" : game.player = "X";
    document.getElementById("player").innerText = "Player " + game.player + " go!";
  }

  function placeMarkerInSelected(cell, game) {
    cell.innerText = game.player; // place user's mark
  }
  
  function cellWasClicked(cell, game) {
      //console.log("start turn " + turnsLeft + " " + (10-turnsLeft));
      placeMarkerInSelected(cell, game);
      (game.turnsLeft < 6) 
        ? checkStatus(cell, game) // check on 5th turn = turnsLeft is 5
        : gameContinues(cell, game);
      game.turnsLeft--; // next turn starts
  }

  function gameReset(game) {    
      for (let i=0; i < game.board.length; i++) 
        game.board[i].innerText = "";
      game.player = "X";
      document.getElementById("player").innerText = "Player " + game.player + " go!";
      game.turnsLeft = 9;
      game.gameover = false;
      //TODO: set up as game property to reduce DOM access
      document.getElementById("message").innerHTML = "";
    // TODO: use DOM methods instead CSS style property
    for (let j = 0; j < game.board.length; j++) {
      game.board[j].style.color = "black";
    }	
  }

function init() { 
/* 
 gameReset(game)
 cellWasClicked(cell, game)
    placeMarkerInSelected(cell, game);
    checkStatus(cell, game) 
        doWeHaveAWinner(cell, game)
        gameContinues(cell, game)
        itIsAScratch(status, game)
          displayWinner(status, game)
        weHaveAWinner(status, game)
          displayWinner(status, game)
    OR 
    gameContinues(cell, game)    
*/     
  var game = {
    player: "",
    turnsLeft: 9,
    gameover: false,
    board: document.getElementsByTagName("td")
  }  
  let len = game.board.length;
  for (let i=0; i < len; i++)
    game.board[i].addEventListener("click", 
      function(){
        cellWasClicked(this, game);
      }
  );             
  document.getElementById("reset").addEventListener("click", 
    function(){ 
      gameReset(game); 
    }
  );  
} // end of init function	

document.addEventListener("DOMContentLoaded", init);    
</script>    
</body>
</html>








